
"use strict"




const fs        = require('fs')
const constants = require('pdir/commons/constants')




const utils = {fs: { }}





utils.fs.listContent = (dir, callback) => {

	fs.lstat(dir, (err, stats) => {

		if (err) {

			utils.fs.listContent.handleError(err, dir)
			return callback([ ])

		}

		if (!stats.isDirectory( )) {
			process.stderr.write(`error: ${dir} was not a directory.`)
		} else {
			fs.access(dir, fs.R_OK, err => {

				if (err) {

					utils.fs.listContent.handleError(err, dir)
					return callback([ ])

				}

				fs.readdir(dir, (err, files) => {
					callback(files)
				})

			})
		}

	})

}

utils.fs.listContent.handleError = (err, dir) => {

	const handledErrors = {
		[constants.errCodes.notFound]: `directory ${dir} does not exist.`
	}

	process.stderr.write(
		handledErrors.hasOwnProperty(err.code)
			? 'error: ' + handledErrors[err.code] + '\n'
			: 'error: ' + err.message + '\n')

}





module.exports = utils
